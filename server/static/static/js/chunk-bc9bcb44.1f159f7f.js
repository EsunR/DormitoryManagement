(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc9bcb44"],{"178a":function(t,e,o){},"180d":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-wrapper",attrs:{id:"RoomInfo"}},[e("h1",{staticClass:"main-title"},[e("span",{staticClass:"mr-gap"},[t._v("宿舍基础信息")]),t._v(" "),t.roomInfo.id?e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(e){t.editModalVisible=!0}}}):t._e(),t._v(" "),e("room-info-edit-modal",{attrs:{visible:t.editModalVisible,roomInfo:t.roomInfo},on:{"update:visible":function(e){t.editModalVisible=e},"update-success":function(e){return t.fetchRoomInfo(t.roomInfo.id)}}})],1),t._v(" "),e("div",{staticClass:"wrapper main-card selector-wrapper"},[e("GroupSelector",{attrs:{selectorData:t.selectorData}}),t._v(" "),e("el-button",{attrs:{type:"primary",round:"",disabled:null===t.selectorData.roomId},on:{click:t.handleSearchRoom}},[t._v("检索宿舍")])],1),t._v(" "),e("div",{staticClass:"wrapper"},[e("PanelGroup",{attrs:{roomInfo:t.roomInfo}})],1),t._v(" "),e("h1",{staticClass:"main-title"},[t._v("宿舍成员")]),t._v(" "),e("div",{staticClass:"wrapper main-card"},[e("StudentsTable",{attrs:{"table-data":t.students}})],1),t._v(" "),e("h1",{staticClass:"main-title"},[t._v("宿舍评价")]),t._v(" "),e("div",{staticClass:"wrapper"},[e("div",{staticClass:"main-card form-wrapper"},[e("el-form",{ref:"evaluateForm",attrs:{model:t.evaluateForm,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"宿舍评价",prop:"note",required:""}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.evaluateForm.note,callback:function(e){t.$set(t.evaluateForm,"note",e)},expression:"evaluateForm.note"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"评分",prop:"score",required:""}},[e("el-input-number",{attrs:{"controls-position":"right",min:1,max:100},model:{value:t.evaluateForm.score,callback:function(e){t.$set(t.evaluateForm,"score",e)},expression:"evaluateForm.score"}})],1)],1),t._v(" "),e("div",{staticClass:"btn-wrapper"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("发表评分")])],1)],1),t._v(" "),e("Evaluates",{attrs:{evaluatesData:t.evaluatesData},on:{afterDel:function(e){return t.fetchRoomInfo(t.roomInfo.id)}}})],1)])},n=[],r=o("c80c"),i=(o("96cf"),o("3b8d")),s=(o("7f7f"),o("3392")),l=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"room-panel-group"}},[t.roomInfo.id?e("el-row",{attrs:{gutter:30}},t._l(t.panelData,(function(o,a){return e("el-col",{key:a,attrs:{sm:24/t.panelData.length}},[e("div",{staticClass:"group-item-wrapper"},[e("div",{staticClass:"icon-wrapper"},[e("i",{staticClass:"icon",class:o.icon,style:{color:o.color}})]),t._v(" "),e("div",{staticClass:"text-wrapper"},[e("div",{staticClass:"title"},[t._v(t._s(o.title))]),t._v(" "),e("div",{staticClass:"content"},[t._v(t._s(o.content))])])])])})),1):e("div",{staticClass:"main-card no-data-tips"},[t._v("\n    = 请选择宿舍 =\n  ")])],1)},u=[],c={name:"RoomPanelGroup",data:function(){return{}},props:{roomInfo:{type:Object,required:!0}},computed:{panelData:function(){var t=this.roomInfo.users.length,e=this.roomInfo.peopleNum-t;return[{icon:"el-icon-s-home",color:"#40C9C6",title:"房间号",content:this.roomInfo.number},{icon:"el-icon-location",color:"#36A3F7",title:"所在楼层",content:this.roomInfo.floor.layer+"层"},{icon:"el-icon-office-building",color:"#F4516C",title:"宿舍楼",content:this.roomInfo.building.name},{icon:"el-icon-user-solid",color:"#34BFA3",title:"已入住 / 剩余床位",content:"".concat(t," / ").concat(e)}]}}},d=c,f=(o("9fb7"),o("2877")),m=Object(f["a"])(d,l,u,!1,null,"184cacbd",null),p=m.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"StudentTable"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:!0}},[e("el-table-column",{attrs:{label:"姓名"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("a",{on:{click:function(e){return t.gotoUserDetail(o.row.id)}}},[t._v(t._s(o.row.name))])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"account",label:"学号"}}),t._v(" "),e("el-table-column",{attrs:{prop:"phone",label:"电话号"}}),t._v(" "),e("el-table-column",{attrs:{label:"入住时间"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t._f("formatDate")(o.row.checkTime,"YYYY-MM-DD")))])]}}])})],1)],1)},b=[],h={name:"StudentTable",data:function(){return{}},props:{tableData:{type:Array,default:function(){return[]}}},methods:{gotoUserDetail:function(t){this.$router.push({name:"userInfo",query:{userId:t}})}}},_=h,I=(o("4090"),Object(f["a"])(_,v,b,!1,null,"c8c26426",null)),g=I.exports,C=o("8e3e"),D=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"room-info-edit-modal",attrs:{title:"修改房间信息",visible:t.visible},on:{"update:visible":function(e){return t.$emit("update:visible",e)}}},[e("el-form",{ref:"form",attrs:{model:t.formData,"label-position":"left"}},[e("el-form-item",{attrs:{prop:"peopleNum",label:"床位数"}},[e("el-input-number",{attrs:{min:t.currentStudentCount,max:20},model:{value:t.formData.peopleNum,callback:function(e){t.$set(t.formData,"peopleNum",e)},expression:"formData.peopleNum"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return t.$emit("update:visible",!1)}}},[t._v("\n      取消\n    ")]),t._v(" "),e("el-button",{attrs:{loading:t.updateLoading,type:"primary"},on:{click:t.onConfirmClick}},[t._v("\n      确定\n    ")])],1)],1)},y=[],w=o("420d"),j={props:{visible:{type:Boolean,default:!1},roomInfo:{type:Object,default:function(){return{}}}},data:function(){return{formData:{peopleNum:null},updateLoading:!1}},methods:{onConfirmClick:function(){var t=this;this.$refs.form.validate((function(e){e&&(t.updateLoading=!0,Object(w["c"])({roomId:t.roomInfo.id,peopleNum:t.formData.peopleNum}).then((function(){t.$emit("update:visible",!1),t.$emit("update-success")})).finally((function(){t.updateLoading=!1})))}))}},computed:{currentStudentCount:function(){return this.roomInfo&&this.roomInfo.users instanceof Array?this.roomInfo.users.length:0},currentPeopleCount:function(){return this.roomInfo&&this.roomInfo.peopleNum||0}},watch:{currentPeopleCount:{immediate:!0,handler:function(t){this.formData.peopleNum=t}}}},O=j,k=Object(f["a"])(O,D,y,!1,null,"1afdb0d4",null),x=k.exports,F=o("dffe"),$={name:"RoomInfo",components:{GroupSelector:s["a"],PanelGroup:p,StudentsTable:g,Evaluates:C["a"],RoomInfoEditModal:x},data:function(){return{roomInfo:{},buildingInfo:{},floorInfo:{},students:[],selectorData:{buildingId:null,floorId:null,roomId:null},evaluatesData:[],evaluateForm:{note:"",score:60},editModalVisible:!1}},watch:{"$route.query.roomId":function(t){t&&"roomInfo"===this.$route.name&&this.fetchRoomInfo(t)}},mounted:function(){var t=this.$route.query.roomId;t&&this.fetchRoomInfo(t)},methods:{fetchRoomInfo:function(){var t=Object(i["a"])(Object(r["a"])().mark((function t(e){var o,a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(w["a"])(e);case 2:return o=t.sent.data,this.roomInfo=o,this.buildingInfo=o.building,this.students=o.users,t.next=8,Object(F["b"])({roomId:o.id});case 8:a=t.sent.data.evaluates,this.evaluatesData=a;case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleSearchRoom:function(){this.$router.push({name:"roomInfo",query:{roomId:this.selectorData.roomId}})},handleSubmit:function(){var t=this;this.$refs.evaluateForm.validate((function(e){e?Object(F["a"])({note:t.evaluateForm.note,score:t.evaluateForm.score,roomId:t.roomInfo.id}).then((function(){t.$message.success("发布成功"),t.fetchRoomInfo(t.roomInfo.id)})):t.$message.error("请填充完整信息")}))}}},S=$,R=(o("b7cc"),Object(f["a"])(S,a,n,!1,null,"4958be70",null));e["default"]=R.exports},2149:function(t,e,o){},4090:function(t,e,o){"use strict";o("178a")},"420d":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"a",(function(){return r})),o.d(e,"c",(function(){return i}));var a=o("b775");function n(t){return Object(a["a"])({url:"/room/getRooms",method:"get",params:t})}function r(t){return Object(a["a"])({url:"/room/getRoomInfo",method:"get",params:{roomId:t}})}function i(t){var e=t.roomId,o=void 0===e?null:e,n=t.peopleNum,r=void 0===n?null:n;return Object(a["a"])({url:"/room/updateInfo",method:"post",data:{roomId:o,peopleNum:r}})}},"8e3e":function(t,e,o){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"room-evaluation"},[e("el-row",{attrs:{gutter:30}},t._l(t.evaluatesData,(function(o){return e("el-col",{key:o.id,attrs:{md:8}},[e("div",{staticClass:"evaluate-item"},[e("div",{staticClass:"top",style:{background:t.getColor(o.score)}},[e("div",{staticClass:"score"},[t._v("\n            评价分数："),e("span",[t._v(t._s(o.score))])]),t._v(" "),e("div",{staticClass:"level"},[t._v(t._s(t.getLevel(o.score)))])]),t._v(" "),e("div",{staticClass:"center"},[e("div",{staticClass:"note"},[t._v("评价："+t._s(o.note))])]),t._v(" "),e("div",{staticClass:"bottom"},[e("div",{staticClass:"creator"},[e("span",{staticStyle:{"margin-right":"5px"}},[t._v("评价人: "+t._s(o.userName))]),t._v(" "),o.userId===t.userId?e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(o.id)}}},[t._v("删除")]):t._e()],1),t._v(" "),e("div",{staticClass:"time"},[t._v("\n            "+t._s(t._f("formatDate")(o.createdAt,"YYYY年MM月DD日 HH:mm"))+"\n          ")])])])])})),1),t._v(" "),0===t.evaluatesData.length?e("div",{staticClass:"tips"},[t._v("= 暂无评价 =")]):t._e()],1)},n=[],r=o("dffe"),i={data:function(){return{}},props:{evaluatesData:{type:Array,required:!0}},computed:{userId:function(){return this.$store.getters.allUserInfo.id}},methods:{getLevel:function(t){return t>=80?"优秀":t>=60?"良好":"差劲"},getColor:function(t){return t>=80?"#1890ff":t>=60?"#FFBA00":"#ff4949"},handleDelete:function(t){var e=this;this.$confirm("确认要删除该条评论","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["c"])(t).then((function(){e.$message.success("删除成功"),e.$emit("afterDel")}))}))}}},s=i,l=(o("960f"),o("2877")),u=Object(l["a"])(s,a,n,!1,null,"569b93a4",null);e["a"]=u.exports},"960f":function(t,e,o){"use strict";o("dfec")},"9fb7":function(t,e,o){"use strict";o("adaa")},adaa:function(t,e,o){},b7cc:function(t,e,o){"use strict";o("2149")},be0e:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return r})),o.d(e,"a",(function(){return i}));var a=o("b775");function n(t){return Object(a["a"])({url:"/floor/getFloors",method:"get",params:t})}function r(t){return Object(a["a"])({url:"/floor/getFloorsDetail",method:"get",params:{buildingId:t}})}function i(t,e){return Object(a["a"])({url:"/floor/addCleanerToFloor",method:"post",data:{floorId:t,cleanerId:e}})}},dfec:function(t,e,o){},dffe:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"a",(function(){return r})),o.d(e,"c",(function(){return i}));var a=o("b775");function n(t){return Object(a["a"])({url:"/evaluate/getEvaluates",method:"get",params:t})}function r(t){var e=t.note,o=t.score,n=t.roomId;return Object(a["a"])({url:"/evaluate/addEvaluate",method:"post",data:{note:e,score:o,roomId:n}})}function i(t){return Object(a["a"])({url:"/evaluate/removeEvaluate",method:"delete",params:{evaluateId:t}})}}}]);